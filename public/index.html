<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- Primary Meta Tags -->
    <title>Link-Lite - 리더십 진단 & 팀 궁합 분석</title>
    <meta name="title" content="Link-Lite - 리더십 진단 & 팀 궁합 분석">
    <meta name="description" content="20개 간단한 질문으로 나의 리더십 스타일을 확인하고 팀원들과 더 잘 소통하는 방법을 알아보세요. SIG 모델 기반 링커십 진단 도구.">
    <meta name="keywords" content="리더십, 진단, 팀 궁합, 링커십, SIG 모델, 팔로워십, 팀 관리, 리더십 테스트">
    <meta name="author" content="Link-Lite">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://link-lite.netlify.app/">
    <meta property="og:title" content="Link-Lite - 리더십 진단 & 팀 궁합 분석">
    <meta property="og:description" content="20개 간단한 질문으로 나의 리더십 스타일을 확인하고 팀원들과 더 잘 소통하는 방법을 알아보세요.">
    <meta property="og:image" content="https://link-lite.netlify.app/og-image.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://link-lite.netlify.app/">
    <meta property="twitter:title" content="Link-Lite - 리더십 진단 & 팀 궁합 분석">
    <meta property="twitter:description" content="20개 간단한 질문으로 나의 리더십 스타일을 확인하고 팀원들과 더 잘 소통하는 방법을 알아보세요.">
    <meta property="twitter:image" content="https://link-lite.netlify.app/og-image.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"></noscript>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="premium-style.css?v=1761005327">
    <link rel="stylesheet" href="mobile-native.css?v=1759492238">

    <!-- Theme Color -->
    <meta name="theme-color" content="#8b5cf6">

    <!-- Critical CSS for initial render -->
    <style>
        body {
            margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .premium-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="welcome-page">
    <div class="premium-container">
        <div class="glass-card" style="max-width: 900px; width: 100%; margin-left: auto; margin-right: auto;">
            <div class="glass-header">
                <h1>Link-Lite</h1>
                <p class="subtitle">간편한 리더십 진단 & 팀 궁합 체크</p>
            </div>

            <div class="premium-content">
                <!-- 시작 화면 -->
                <div id="welcome" class="premium-section active">
                    <div class="welcome-section">
                        <h2 class="welcome-title">일일이 챙겨야 팀이 움직이나요?</h2>
                        <p class="welcome-subtitle">AI 시대 새로운 리더십, 링커십(Linkership)</p>
                        <p class="welcome-description">
                            강한 지시보다 단단한 연결이 팀을 움직입니다.<br>
                            짧은 참여로 나의 링커십과 팔로워십을 확인하고,<br>
                            팀 실행력을 높일 인사이트를 발견하세요.
                        </p>

                        <div class="feature-grid">
                            <div class="feature-item">
                                <div class="feature-icon-modern analytics"></div>
                                <div class="feature-content">
                                    <h3 class="feature-title">SIG 모델 진단</h3>
                                    <p class="feature-description">공유·상호작용·성장 영역 분석</p>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon-modern collaboration"></div>
                                <div class="feature-content">
                                    <h3 class="feature-title">팔로워십 매칭</h3>
                                    <p class="feature-description">팀원 유형별 맞춤 코칭 전략</p>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon-modern insights"></div>
                                <div class="feature-content">
                                    <h3 class="feature-title">링커십 전환</h3>
                                    <p class="feature-description">연결자로서의 실행 가이드</p>
                                </div>
                            </div>
                        </div>

                        <button class="premium-btn" onclick="startAssessment()">
                            <span>진단 시작</span>
                            <span>→</span>
                        </button>
                    </div>
                </div>

                <!-- 진단 화면 -->
                <div id="assessment" class="premium-section">
                    <div class="premium-progress">
                        <div class="premium-progress-fill" id="progressBar"></div>
                    </div>

                    <div class="premium-question-card">
                        <div class="question-meta">
                            <div class="question-number" id="questionNumber"></div>
                        </div>

                        <div class="question-text" id="questionText"></div>

                        <div id="interactiveInput"></div>
                    </div>

                    <div class="premium-nav">
                        <button class="premium-btn premium-btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>
                            ← 이전
                        </button>
                        <button class="premium-btn" id="nextBtn" onclick="nextQuestion()" disabled>
                            <span id="nextBtnText">다음</span>
                            <span>→</span>
                        </button>
                    </div>
                </div>

                <!-- 팔로워십 선택 화면 -->
                <div id="followership" class="premium-section">
                    <div class="followership-selection">
                        <div class="section-header">
                            <h2 class="section-title">팀원의 팔로워십 유형을 선택하세요</h2>
                            <p class="section-description">팀원의 유형에 따라 리더십 궁합과 맞춤형 코칭 전략을 제시합니다.<br>최소 1명 이상의 팀원을 선택해주세요.</p>
                        </div>

                        <div class="followership-grid" id="followershipOptionsPage"></div>

                        <div class="premium-nav" style="margin-top: var(--space-10);">
                            <button class="premium-btn premium-btn-secondary" onclick="showSection('assessment')">
                                ← 이전
                            </button>
                            <button class="premium-btn" onclick="showResultsPage()" id="showResultsBtn" disabled>
                                <span>결과 보기</span>
                                <span>→</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 결과 화면 -->
                <div id="results" class="premium-section">
                    <div class="premium-results">
                        <!-- 1. 나의 리더십 특징 -->
                        <section class="results-section">
                            <h2 class="results-main-title">나의 리더십 특징</h2>
                            <p class="results-intro">평소 팀과의 상호작용 패턴을 분석하여, 현재 강점과 보완이 필요한 영역을 파악했습니다.</p>

                            <div class="leadership-type-card">
                                <div class="leadership-card-header">
                                    <div class="leadership-type-info">
                                        <h3 class="leadership-type" id="leadershipType"></h3>
                                        <p class="leadership-subtitle" id="leadershipSubtitle"></p>
                                    </div>
                                </div>

                                <!-- 그래프와 점수 카드 통합 -->
                                <div class="leadership-chart-section">
                                    <div class="radar-chart-wrapper">
                                <svg id="radarChart" class="radar-chart" viewBox="0 0 400 420">
                                    <!-- 배경 그리드 -->
                                    <g class="radar-grid" transform="translate(0, 25)">
                                        <!-- 동심원들 (1점~6점) -->
                                        <circle cx="200" cy="200" r="32" class="grid-circle" />   <!-- 2점 -->
                                        <circle cx="200" cy="200" r="64" class="grid-circle" />   <!-- 3점 -->
                                        <circle cx="200" cy="200" r="96" class="grid-circle" />   <!-- 4점 -->
                                        <circle cx="200" cy="200" r="128" class="grid-circle" />  <!-- 5점 -->
                                        <circle cx="200" cy="200" r="160" class="grid-circle" />  <!-- 6점 -->
                                        <!-- 축선들 -->
                                        <!-- Sharing 축 (위쪽 -90도) -->
                                        <line x1="200" y1="200" x2="200.00" y2="40.00" class="grid-line" />
                                        <!-- Interaction 축 (오른쪽 아래 30도) -->
                                        <line x1="200" y1="200" x2="338.56" y2="280.00" class="grid-line" />
                                        <!-- Growth 축 (왼쪽 아래 150도) -->
                                        <line x1="200" y1="200" x2="61.44" y2="280.00" class="grid-line" />
                                    </g>

                                    <!-- 점수 영역 -->
                                    <g transform="translate(0, 25)">
                                        <polygon id="scoreArea" class="score-area" />

                                        <!-- 점수 포인트들 -->
                                        <g class="score-points">
                                            <circle id="sharingPoint" class="score-point sharing" r="6" />
                                            <circle id="interactionPoint" class="score-point interaction" r="6" />
                                            <circle id="growthPoint" class="score-point growth" r="6" />
                                        </g>
                                    </g>

                                    <!-- 레이블들 -->
                                    <g class="radar-labels">
                                        <text x="200" y="25" text-anchor="middle" class="radar-label">
                                            <tspan x="200" dy="0">Sharing</tspan>
                                            <tspan x="200" dy="22" class="label-desc">공유</tspan>
                                        </text>
                                        <text x="350" y="330" text-anchor="middle" class="radar-label">
                                            <tspan x="350" dy="0">Interaction</tspan>
                                            <tspan x="350" dy="22" class="label-desc">상호작용</tspan>
                                        </text>
                                        <text x="45" y="330" text-anchor="middle" class="radar-label">
                                            <tspan x="45" dy="0">Growth</tspan>
                                            <tspan x="45" dy="22" class="label-desc">성장</tspan>
                                        </text>
                                    </g>

                                </svg>
                            </div>
                        </div>

                                <!-- 강점과 주의사항 -->
                                <div class="leadership-details">
                                    <div class="detail-section">
                                        <h4 class="detail-title">강점</h4>
                                        <ul id="leadershipStrengths" class="detail-list"></ul>
                                    </div>
                                    <div class="detail-section">
                                        <h4 class="detail-title">주의</h4>
                                        <ul id="leadershipCautions" class="detail-list"></ul>
                                    </div>
                                </div>
                            </div>

                        </section>

                        <!-- 2. 팀 궁합 분석 맛보기 -->
                        <section class="results-section">
                            <h2 class="results-main-title">팀 궁합 분석 맛보기</h2>
                            <p class="results-intro">선택하신 팀원들의 팔로워십 유형과 리더십 궁합을 분석했습니다.</p>

                            <div id="compatibilityList" class="compatibility-list-container"></div>
                        </section>

                        <!-- 3. 통합 CTA -->
                        <section class="results-section final-cta-section">
                            <div class="full-version-cta-unified">
                                <div class="cta-header-line"></div>
                                <h3 class="cta-main-title">팀 기반 성장을 위한 조직 문화 조성에 관심이 있으신가요?</h3>
                                <p class="cta-main-desc">팀과 함께하는 Link 팀 진단 참여를 통해 우리 만의 팀 문화 조성을 위한 방향성을 알아보세요!</p>

                                <div class="cta-dual-columns">
                                    <div class="cta-column">
                                        <h4 class="cta-column-title">Link 팀 진단 주요 내용</h4>
                                        <ul class="cta-list-unified">
                                            <li>팀 기반 성장 촉진을 위한 현재 우리 팀의 강점/개선점</li>
                                            <li>팀 몰입도 수준</li>
                                            <li>나의 리더십 특징과 유의점 Tip</li>
                                        </ul>
                                    </div>
                                    <div class="cta-column">
                                        <h4 class="cta-column-title">팀 구성원 팔로워십 분석</h4>
                                        <ul class="cta-list-unified">
                                            <li>팀 구성원의 팔로워십 유형</li>
                                            <li>우리 팀의 팔로워십 맵</li>
                                            <li>나의 리더십 스타일 X 팔로워십 스타일별 코칭 팁 및 유의점</li>
                                        </ul>
                                    </div>
                                </div>

                                <button class="cta-button-primary" onclick="alert('팀 진단 문의: contact@link-team.com')">
                                    <span>Link 팀 진단 알아보기</span>
                                    <span class="cta-arrow">→</span>
                                </button>
                            </div>
                        </section>

                        <div style="margin-top: var(--space-12); text-align: center;">
                            <button class="premium-btn premium-btn-secondary" onclick="resetAssessment()">
                                ↻ 다시 진단하기
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="leadership-assessment.js?v=14"></script>
    <script src="team-compatibility.js?v=14"></script>
    <script src="mobile-native.js?v=17"></script>
    <script>
        // Global Error Handler
        window.addEventListener('error', function(event) {
            console.error('전역 에러 발생:', event.error);
            showErrorMessage('일시적인 오류가 발생했습니다. 페이지를 새로고침해주세요.');
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('처리되지 않은 Promise 거부:', event.reason);
            showErrorMessage('데이터 처리 중 오류가 발생했습니다.');
        });

        function showErrorMessage(message) {
            // 기존 에러 메시지가 있다면 제거
            const existingError = document.querySelector('.error-toast');
            if (existingError) {
                existingError.remove();
            }

            // 에러 토스트 생성
            const errorToast = document.createElement('div');
            errorToast.className = 'error-toast';
            errorToast.textContent = message;
            errorToast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #ef4444, #dc2626);
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                font-weight: 500;
                animation: slideDown 0.3s ease;
            `;

            document.body.appendChild(errorToast);

            // 3초 후 자동 제거
            setTimeout(() => {
                errorToast.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => errorToast.remove(), 300);
            }, 3000);
        }

        // 애니메이션 스타일 추가
        if (!document.querySelector('#error-animations')) {
            const style = document.createElement('style');
            style.id = 'error-animations';
            style.textContent = `
                @keyframes slideDown {
                    from { transform: translate(-50%, -100%); opacity: 0; }
                    to { transform: translate(-50%, 0); opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translate(-50%, 0); opacity: 1; }
                    to { transform: translate(-50%, -100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        let assessment = new LeadershipAssessment();
        let teamCompatibility = new TeamCompatibility();
        let currentQuestion = 0;
        let selectedFollowerTypes = []; // { id: string, name: string, memberName: string }
        let mobileInput = null;
        let mobileNav = null;

        // 비동기 데이터 로딩 초기화
        async function initializeApp() {
            try {
                // 시작 버튼 비활성화
                const startBtn = document.querySelector('.premium-btn');
                if (startBtn) {
                    startBtn.disabled = true;
                    startBtn.textContent = '데이터 로딩 중...';
                }

                await Promise.all([
                    assessment.init(),
                    teamCompatibility.init()
                ]);
                console.log('App initialized successfully');

                // 시작 버튼 활성화
                if (startBtn) {
                    startBtn.disabled = false;
                    startBtn.innerHTML = '<span>진단 시작</span><span>→</span>';
                }
            } catch (error) {
                console.error('App initialization failed:', error);
                showErrorMessage('데이터를 불러오는 중 오류가 발생했습니다. 페이지를 새로고침해주세요.');
            }
        }

        // 페이지 로드 시 초기화
        initializeApp();

        function startAssessment() {
            // 초기화 완료 확인
            if (!assessment.isInitialized || !teamCompatibility.isInitialized) {
                showErrorMessage('데이터가 아직 로드되지 않았습니다. 잠시 후 다시 시도해주세요.');
                return;
            }
            try {
                showSection('assessment');

                // Initialize mobile navigation for mobile screens
                if (window.innerWidth <= 768 && !mobileNav) {
                    mobileNav = new MobileNavigationManager();
                }

                loadQuestion(0);
            } catch (error) {
                console.error('진단 시작 오류:', error);
                showErrorMessage('진단을 시작할 수 없습니다. 페이지를 새로고침해주세요.');
            }
        }

        function showSection(sectionId) {
            // 모든 섹션 숨기기
            document.querySelectorAll('.premium-section').forEach(section => {
                section.classList.remove('active');
            });

            // body 클래스 변경 (페이지별 레이아웃)
            document.body.className = sectionId === 'welcome' ? 'welcome-page' : 'content-page';

            // 모바일 네비게이션 표시/숨김 처리
            if (mobileNav) {
                if (sectionId === 'results' || sectionId === 'welcome') {
                    // 결과 페이지나 시작 페이지에서는 모바일 네비게이션 숨김
                    mobileNav.hide();
                } else if (sectionId === 'assessment') {
                    // 진단 페이지에서는 모바일 네비게이션 표시
                    mobileNav.show();
                    // 버튼 상태는 loadQuestion에서 업데이트됨
                } else if (sectionId === 'followership') {
                    // 팔로워십 선택 페이지에서도 모바일 네비게이션 표시
                    mobileNav.show();
                    // 팔로워십 페이지용 버튼 업데이트
                    updateFollowershipNavigation();
                }
            }

            // 새 섹션 표시
            setTimeout(() => {
                document.getElementById(sectionId).classList.add('active');
            }, 150);
        }

        function loadQuestion(index) {
            currentQuestion = index;
            const question = assessment.getQuestion(index);
            const totalQuestions = assessment.getTotalQuestions();

            // 질문 정보 업데이트
            document.getElementById('questionNumber').textContent = `${index + 1} / ${totalQuestions}`;
            document.getElementById('questionText').textContent = question.text;

            // 진행률 업데이트
            const progress = ((index + 1) / totalQuestions) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            // 모바일 네이티브 입력 시스템 초기화
            const inputContainer = document.getElementById('interactiveInput');

            // 기존 인스턴스 정리
            if (mobileInput) {
                mobileInput.destroy();
            }

            // 새 모바일 입력 생성
            const currentResponse = assessment.responses[question.id]; // undefined if not answered
            mobileInput = new MobileNativeInput(inputContainer, {
                defaultValue: currentResponse, // Will be null for new questions
                min: 1,
                max: 6,
                onChange: (value) => {
                    assessment.recordResponse(question.id, value);
                    updateNextButton();
                }
            });

            // 버튼 상태 업데이트 (이전 버튼은 항상 활성화)
            document.getElementById('prevBtn').disabled = false;
            updateNextButton();

            // 모바일 네비게이션 업데이트 (모바일 화면에서만)
            if (mobileNav && window.innerWidth <= 768) {
                const canGoPrev = true; // 항상 이전 버튼 활성화
                const canGoNext = assessment.responses[question.id] !== undefined;

                mobileNav.updateNavigation(canGoPrev, canGoNext, '다음');
            }
        }

        function getCategoryName(category) {
            const names = {
                'sharing': '공유 및 참여',
                'interaction': '상호작용',
                'growth': '성장지향'
            };
            return names[category] || category;
        }

        // selectScale 함수는 더 이상 필요하지 않음 (인터랙티브 입력에서 처리)

        function updateNextButton() {
            const question = assessment.getQuestion(currentQuestion);
            const hasResponse = assessment.responses[question.id] !== undefined;
            const totalQuestions = assessment.getTotalQuestions();
            const isLastQuestion = currentQuestion === totalQuestions - 1;

            const nextBtn = document.getElementById('nextBtn');
            const nextBtnText = document.getElementById('nextBtnText');

            nextBtn.disabled = !hasResponse;
            // 모든 질문에서 "다음" 표시 (팔로워십 선택 화면으로 이동)
            nextBtnText.textContent = '다음';

            // 모바일 네비게이션도 업데이트 (모바일 화면에서만)
            if (mobileNav && window.innerWidth <= 768) {
                const canGoPrev = true; // 항상 이전 버튼 활성화
                mobileNav.updateNavigation(canGoPrev, hasResponse, '다음');
            }
        }

        function nextQuestion() {
            if (currentQuestion < assessment.getTotalQuestions() - 1) {
                loadQuestion(currentQuestion + 1);
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                loadQuestion(currentQuestion - 1);
            } else {
                // 첫 질문에서 이전 버튼 클릭 시 시작 화면으로
                showSection('welcome');
            }
        }

        // Expose functions to window for mobile navigation
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.goBackToAssessment = goBackToAssessment;
        window.showResultsPage = showResultsPage;

        function showResults() {
            const result = assessment.determineLeadershipType();

            // 더 자세한 디버깅용 로그
            console.log('=== LEADERSHIP TYPE DEBUG ===');
            console.log('Assessment object:', assessment);
            console.log('Assessment result:', result);
            console.log('Type code:', result.code);
            console.log('Type object:', result.type);
            console.log('Scores:', result.scores);
            console.log('Available leadership types:', assessment.leadershipTypes);
            console.log('Type found in leadershipTypes:', assessment.leadershipTypes[result.code]);
            console.log('=============================');

            // 리더십 유형 표시
            const leadershipTypeElement = document.getElementById('leadershipType');
            const leadershipSubtitleElement = document.getElementById('leadershipSubtitle');
            const leadershipStrengthsElement = document.getElementById('leadershipStrengths');
            const leadershipCautionsElement = document.getElementById('leadershipCautions');

            if (result.type && result.type.name) {
                leadershipTypeElement.textContent = result.type.name;
                leadershipSubtitleElement.textContent = result.type.subtitle || '';

                // 강점 표시
                leadershipStrengthsElement.innerHTML = '';
                if (result.type.strengths && result.type.strengths.length > 0) {
                    result.type.strengths.forEach(strength => {
                        const li = document.createElement('li');
                        li.textContent = strength;
                        leadershipStrengthsElement.appendChild(li);
                    });
                }

                // 주의점 표시
                leadershipCautionsElement.innerHTML = '';
                if (result.type.cautions && result.type.cautions.length > 0) {
                    result.type.cautions.forEach(caution => {
                        const li = document.createElement('li');
                        li.textContent = caution;
                        leadershipCautionsElement.appendChild(li);
                    });
                }

                console.log('✓ Successfully displayed leadership type:', result.type.name);
            } else {
                // 문제가 있을 때 더 자세한 디버깅 정보 표시
                const debugInfo = `디버그: 코드=${result.code}, 타입객체=${JSON.stringify(result.type)}`;
                leadershipTypeElement.textContent = debugInfo;
                console.error('✗ Failed to display leadership type. Result.type:', result.type);
                console.error('✗ Code lookup result:', assessment.leadershipTypes[result.code]);
            }

            // 레이더 차트 업데이트
            updateRadarChart(result.scores);

            // 팔로워십 선택 페이지로 이동
            createFollowershipOptionsPage();
            showSection('followership');
        }

        function createFollowershipOptionsPage() {
            const container = document.getElementById('followershipOptionsPage');
            container.innerHTML = '';

            const followershipTypes = teamCompatibility.followershipTypes;

            Object.keys(followershipTypes).forEach(typeId => {
                const type = followershipTypes[typeId];
                const card = document.createElement('div');
                card.className = 'followership-card';
                card.setAttribute('data-type-id', typeId);

                card.innerHTML = `
                    <div class="followership-card-main">
                        <div class="followership-checkbox">
                            <input type="checkbox" id="follower_${typeId}" value="${typeId}" onchange="toggleFollowershipType('${typeId}')">
                        </div>
                        <div class="followership-info">
                            <h4 class="followership-type-name">${type.name}</h4>
                            <p class="followership-type-desc">${type.description}</p>
                        </div>
                    </div>
                    <div class="member-name-input" id="memberInput_${typeId}" style="display: none;">
                        <input type="text" placeholder="팀원 이름 입력 (여러 명은 쉼표(,)나 공백으로 구분)" class="member-name-field" id="memberName_${typeId}">
                    </div>
                `;

                // 카드 전체 클릭 시 체크박스 토글 (이름 입력 필드 제외)
                card.addEventListener('click', (e) => {
                    // 체크박스나 이름 입력 필드 클릭 시에는 기본 동작 유지
                    if (e.target.type === 'checkbox' || e.target.type === 'text') {
                        return;
                    }
                    const checkbox = document.getElementById(`follower_${typeId}`);
                    checkbox.checked = !checkbox.checked;
                    toggleFollowershipType(typeId);
                });

                container.appendChild(card);
            });

            updateShowResultsButton();
        }

        function toggleFollowershipType(typeId) {
            const checkbox = document.getElementById(`follower_${typeId}`);
            const memberInput = document.getElementById(`memberInput_${typeId}`);
            const card = checkbox.closest('.followership-card');

            if (checkbox.checked) {
                memberInput.style.display = 'block';
                card.classList.add('selected');
                // 이미 선택된 항목이 아니면 추가
                if (!selectedFollowerTypes.find(f => f.id === typeId)) {
                    selectedFollowerTypes.push({ id: typeId, name: '', memberName: '' });
                }
            } else {
                memberInput.style.display = 'none';
                card.classList.remove('selected');
                // 선택 해제 시 배열에서 제거
                selectedFollowerTypes = selectedFollowerTypes.filter(f => f.id !== typeId);
            }

            updateShowResultsButton();
            updateFollowershipNavigation(); // 모바일 네비게이션도 업데이트
        }

        function updateShowResultsButton() {
            const btn = document.getElementById('showResultsBtn');
            btn.disabled = selectedFollowerTypes.length === 0;
        }

        function updateFollowershipNavigation() {
            // 모바일 네비게이션 버튼 업데이트
            if (mobileNav && window.innerWidth <= 768) {
                const canGoPrev = true; // 이전 버튼 항상 활성화
                const canGoNext = selectedFollowerTypes.length > 0; // 최소 1개 선택 시 활성화
                mobileNav.updateNavigation(canGoPrev, canGoNext, '결과 보기');
            }
        }

        function goBackToAssessment() {
            // 마지막 질문으로 돌아가기
            showSection('assessment');
            loadQuestion(assessment.getTotalQuestions() - 1);
        }

        function showResultsPage() {
            try {
                console.log('=== 결과 페이지로 이동 ===');
                console.log('선택된 팔로워십 수:', selectedFollowerTypes.length);

                if (selectedFollowerTypes.length === 0) {
                    showErrorMessage('팔로워십 유형을 최소 1개 이상 선택해주세요.');
                    return;
                }

                // 팀원 이름 수집 및 다중 이름 처리
                const expandedFollowers = [];
                selectedFollowerTypes.forEach(follower => {
                    const nameInput = document.getElementById(`memberName_${follower.id}`);
                    if (nameInput && nameInput.value.trim()) {
                        // 쉼표(,) 또는 공백으로 구분하여 여러 이름 처리
                        const names = nameInput.value
                            .split(/[,\s]+/)  // 쉼표 또는 공백으로 분리
                            .map(name => name.trim())
                            .filter(name => name.length > 0);

                        if (names.length > 0) {
                            names.forEach(name => {
                                expandedFollowers.push({
                                    id: follower.id,
                                    name: teamCompatibility.followershipTypes[follower.id].name,
                                    memberName: name
                                });
                            });
                        } else {
                            expandedFollowers.push({
                                id: follower.id,
                                name: teamCompatibility.followershipTypes[follower.id].name,
                                memberName: '팀원'
                            });
                        }
                    } else {
                        expandedFollowers.push({
                            id: follower.id,
                            name: teamCompatibility.followershipTypes[follower.id].name,
                            memberName: '팀원'
                        });
                    }
                });

                selectedFollowerTypes = expandedFollowers;
                console.log('확장된 팀원 정보:', selectedFollowerTypes);

                // 궁합 분석 실행
                analyzeCompatibilityAuto();

                // 결과 페이지로 이동
                showSection('results');
            } catch (error) {
                console.error('결과 페이지 이동 중 오류:', error);
                showErrorMessage('결과 페이지로 이동 중 오류가 발생했습니다: ' + error.message);
            }
        }

        function analyzeCompatibilityAuto() {
            try {
                const result = assessment.determineLeadershipType();
                const compatibilityList = document.getElementById('compatibilityList');

                compatibilityList.innerHTML = '';

                console.log('=== 팔로워십 분석 시작 ===');
                console.log('리더십 코드:', result.code);
                console.log('선택된 팔로워십:', selectedFollowerTypes);

                if (selectedFollowerTypes.length === 0) {
                    compatibilityList.innerHTML = '<p class="empty-message">선택된 팀원이 없습니다.</p>';
                    return;
                }

                // 동일한 팔로워십 유형끼리 그룹화
                const groupedFollowers = {};
                selectedFollowerTypes.forEach(follower => {
                    if (!groupedFollowers[follower.id]) {
                        groupedFollowers[follower.id] = [];
                    }
                    groupedFollowers[follower.id].push(follower.memberName);
                });

                // 그룹화된 데이터로 카드 생성
                Object.keys(groupedFollowers).forEach(followerId => {
                    const memberNames = groupedFollowers[followerId];
                    const followerType = teamCompatibility.followershipTypes[followerId];
                    const compatibility = teamCompatibility.analyzeCompatibility(result.code, followerId);

                    console.log('분석 중:', followerId, memberNames);
                    console.log('분석 결과:', compatibility);

                    const card = document.createElement('div');
                    card.className = 'compatibility-unified-card';

                    // 팀원 이름들을 개별 배지로 표시
                    const nameBadges = memberNames.map(name =>
                        `<span class="member-name-badge">${name}</span>`
                    ).join('');

                    card.innerHTML = `
                        <div class="compatibility-card-header">
                            <div class="follower-info">
                                <h4 class="follower-type-name">${followerType.name}</h4>
                                <p class="follower-type-subtitle">${followerType.subtitle}</p>
                            </div>
                            <div class="member-names-container">${nameBadges}</div>
                        </div>
                        <div class="compatibility-analysis">
                            <div class="analysis-row">
                                <div class="analysis-label">강점</div>
                                <div class="analysis-content">${compatibility.strengths[0]}</div>
                            </div>
                            <div class="analysis-row">
                                <div class="analysis-label">주의</div>
                                <div class="analysis-content">${compatibility.challenges[0]}</div>
                            </div>
                        </div>
                    `;

                    compatibilityList.appendChild(card);
                });

                console.log('=== 팔로워십 분석 완료 ===');
            } catch (error) {
                console.error('팔로워십 분석 중 오류:', error);
                showErrorMessage('팔로워십 분석 중 오류가 발생했습니다: ' + error.message);
            }
        }

        function updateRadarChart(scores) {
            // 점수를 0-6 범위에서 0-160으로 변환 (중심에서 최대 반지름까지)
            const center = 200;
            const maxRadius = 160;

            // 각 축의 각도 (라디안) - 120도씩 균등 분할
            const angles = {
                sharing: -Math.PI / 2,           // 위쪽 (90도)
                interaction: Math.PI / 6,        // 오른쪽 아래 (30도)
                growth: 5 * Math.PI / 6          // 왼쪽 아래 (150도)
            };

            // 점수에 따른 반지름 계산 (1~6점 범위)
            const sharingRadius = ((scores.sharing - 1) / 5) * maxRadius;
            const interactionRadius = ((scores.interaction - 1) / 5) * maxRadius;
            const growthRadius = ((scores.growth - 1) / 5) * maxRadius;

            // 각 점의 좌표 계산
            const sharingX = center + sharingRadius * Math.cos(angles.sharing);
            const sharingY = center + sharingRadius * Math.sin(angles.sharing);

            const interactionX = center + interactionRadius * Math.cos(angles.interaction);
            const interactionY = center + interactionRadius * Math.sin(angles.interaction);

            const growthX = center + growthRadius * Math.cos(angles.growth);
            const growthY = center + growthRadius * Math.sin(angles.growth);

            // 점수 포인트 위치 업데이트
            document.getElementById('sharingPoint').setAttribute('cx', sharingX);
            document.getElementById('sharingPoint').setAttribute('cy', sharingY);

            document.getElementById('interactionPoint').setAttribute('cx', interactionX);
            document.getElementById('interactionPoint').setAttribute('cy', interactionY);

            document.getElementById('growthPoint').setAttribute('cx', growthX);
            document.getElementById('growthPoint').setAttribute('cy', growthY);

            // 폴리곤 영역 업데이트
            const polygonPoints = `${sharingX},${sharingY} ${interactionX},${interactionY} ${growthX},${growthY}`;
            document.getElementById('scoreArea').setAttribute('points', polygonPoints);


            // 애니메이션 효과 추가
            animateRadarChart();

            // 인터랙티브 효과 추가
            addRadarChartInteraction(scores);
        }

        function displayLowerFactorScores(lowerFactorScores) {
            const lowerFactorNames = {
                's1_진행공유': '진행공유',
                's2_목표공유': '목표공유',
                's3_의견반영': '의견반영',
                'i1_정서케어': '정서케어',
                'i2_문제해결': '문제해결',
                'i3_개방성': '개방성',
                'i4_팀역동이해': '팀역동이해',
                'g1_실패학습': '실패학습',
                'g2_도전촉진': '도전촉진',
                'g3_결과수준': '결과수준',
                'g5_일의의미': '일의의미',
                'g6_주도성촉진': '주도성촉진',
                'g8_일의의미': '일의의미'
            };

            // 각 카테고리별로 하위요인 그룹화
            const groupedFactors = {
                '공유및참여': [],
                '상호작용': [],
                '성장촉진': []
            };

            Object.keys(lowerFactorScores).forEach(key => {
                const factor = lowerFactorScores[key];
                const upperFactor = factor.upperFactor;
                groupedFactors[upperFactor].push({
                    code: key,
                    name: lowerFactorNames[key] || key,
                    score: factor.average.toFixed(1)
                });
            });

            // 각 점수 카드에 하위요인 추가
            const categories = [
                { id: 'sharing', upperFactor: '공유및참여' },
                { id: 'interaction', upperFactor: '상호작용' },
                { id: 'growth', upperFactor: '성장촉진' }
            ];

            categories.forEach(cat => {
                const card = document.querySelector(`[data-category="${cat.id}"]`);
                if (card) {
                    // 기존 하위요인 정보 제거
                    const existingDetail = card.querySelector('.lower-factors');
                    if (existingDetail) existingDetail.remove();

                    // 하위요인 정보 생성
                    const lowerFactorsDiv = document.createElement('div');
                    lowerFactorsDiv.className = 'lower-factors';
                    lowerFactorsDiv.style.cssText = 'margin-top: 12px; font-size: 13px; color: var(--slate-600); line-height: 1.6;';

                    const factors = groupedFactors[cat.upperFactor];
                    if (factors && factors.length > 0) {
                        factors.forEach(f => {
                            const factorItem = document.createElement('div');
                            factorItem.style.cssText = 'display: flex; justify-content: space-between; margin-bottom: 4px;';
                            factorItem.innerHTML = `
                                <span style="color: var(--slate-600);">${f.name}</span>
                                <span style="font-weight: 600; color: var(--slate-700);">${f.score}</span>
                            `;
                            lowerFactorsDiv.appendChild(factorItem);
                        });
                    }

                    card.appendChild(lowerFactorsDiv);
                }
            });
        }

        function animateRadarChart() {
            const scoreArea = document.getElementById('scoreArea');
            const points = document.querySelectorAll('.score-point');

            // 초기 상태 설정
            scoreArea.style.opacity = '0';
            scoreArea.style.transform = 'scale(0)';

            points.forEach((point, index) => {
                point.style.opacity = '0';
                point.style.transform = 'scale(0)';
            });

            // 애니메이션 실행
            setTimeout(() => {
                scoreArea.style.transition = 'all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)';
                scoreArea.style.opacity = '1';
                scoreArea.style.transform = 'scale(1)';
            }, 300);

            points.forEach((point, index) => {
                setTimeout(() => {
                    point.style.transition = 'all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)';
                    point.style.opacity = '1';
                    point.style.transform = 'scale(1)';
                }, 500 + index * 200);
            });
        }

        function addRadarChartInteraction(scores) {
            const scorePoints = document.querySelectorAll('.score-point');
            const scoreCards = document.querySelectorAll('.score-detail-card');

            // 점수 포인트 클릭/호버 이벤트
            scorePoints.forEach((point) => {
                const category = point.classList[1]; // sharing, interaction, growth

                point.addEventListener('mouseenter', () => {
                    // 해당 카테고리 카드 하이라이트
                    const targetCard = document.querySelector(`[data-category="${category}"]`);
                    if (targetCard) {
                        targetCard.style.transform = 'translateY(-4px) scale(1.02)';
                        targetCard.style.boxShadow = '0 12px 32px rgba(71, 85, 105, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.7)';
                    }

                    // 점수 영역 하이라이트
                    const scoreArea = document.getElementById('scoreArea');
                    scoreArea.style.fill = `rgba(${getCategoryColor(category)}, 0.3)`;
                    scoreArea.style.stroke = `rgba(${getCategoryColor(category)}, 0.8)`;
                });

                point.addEventListener('mouseleave', () => {
                    // 카드 원래 상태로
                    const targetCard = document.querySelector(`[data-category="${category}"]`);
                    if (targetCard) {
                        targetCard.style.transform = '';
                        targetCard.style.boxShadow = '';
                    }

                    // 점수 영역 원래 상태로
                    const scoreArea = document.getElementById('scoreArea');
                    scoreArea.style.fill = 'rgba(139, 92, 246, 0.15)';
                    scoreArea.style.stroke = 'rgba(139, 92, 246, 0.6)';
                });

                point.addEventListener('click', () => {
                    // 점수 카드 애니메이션
                    const targetCard = document.querySelector(`[data-category="${category}"]`);
                    if (targetCard) {
                        targetCard.style.animation = 'scoreCardPulse 0.6s ease';
                        setTimeout(() => {
                            targetCard.style.animation = '';
                        }, 600);
                    }
                });
            });

            // 점수 카드 호버 이벤트
            scoreCards.forEach((card) => {
                const category = card.dataset.category;

                card.addEventListener('mouseenter', () => {
                    // 해당 점수 포인트 하이라이트
                    const targetPoint = document.querySelector(`.score-point.${category}`);
                    if (targetPoint) {
                        targetPoint.setAttribute('r', '9');
                        targetPoint.style.filter = 'drop-shadow(0 6px 12px rgba(0, 0, 0, 0.3))';
                    }
                });

                card.addEventListener('mouseleave', () => {
                    // 점수 포인트 원래 상태로
                    const targetPoint = document.querySelector(`.score-point.${category}`);
                    if (targetPoint) {
                        targetPoint.setAttribute('r', '6');
                        targetPoint.style.filter = 'drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1))';
                    }
                });
            });
        }

        function getCategoryColor(category) {
            switch (category) {
                case 'sharing':
                    return '16, 185, 129';  // green
                case 'interaction':
                    return '59, 130, 246';  // blue
                case 'growth':
                    return '245, 158, 11';  // amber
                default:
                    return '139, 92, 246';  // purple
            }
        }

        function createFollowershipOptions() {
            const container = document.getElementById('followershipOptions');
            container.innerHTML = '';

            // 기존 스타일 제거 (캐시 방지)
            const oldStyle = document.querySelector('.followership-section-style');
            if (oldStyle) {
                oldStyle.remove();
            }

            // 팔로워십 섹션 스타일 추가
            if (true) {
                const style = document.createElement('style');
                style.className = 'followership-section-style';
                style.textContent = `
                    .followership-section {
                        background: var(--primary-50);
                        border-radius: var(--radius-2xl);
                        padding: var(--space-10);
                        margin-top: var(--space-12);
                        border: 1px solid var(--primary-200);
                    }

                    .section-title {
                        font-size: var(--font-size-3xl);
                        font-weight: 600;
                        color: var(--primary-900);
                        margin-bottom: var(--space-4);
                        text-align: center;
                    }

                    .section-description {
                        color: var(--primary-600);
                        text-align: center;
                        margin-bottom: var(--space-8);
                        font-size: var(--font-size-lg);
                        line-height: 1.6;
                    }

                    .followership-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                        gap: var(--space-3);
                        margin-bottom: var(--space-8);
                    }

                    .followership-card {
                        background: rgba(255, 255, 255, 0.8);
                        backdrop-filter: blur(8px) saturate(140%);
                        border: 1px solid rgba(255, 255, 255, 0.4);
                        border-radius: var(--radius-2xl);
                        padding: var(--space-3) var(--space-4);
                        cursor: pointer;
                        transition: all var(--transition-base);
                        text-align: left;
                        position: relative;
                        box-shadow:
                            0 4px 16px rgba(71, 85, 105, 0.08),
                            inset 0 1px 0 rgba(255, 255, 255, 0.5);
                    }

                    .followership-card:hover {
                        border-color: var(--accent-400);
                        transform: translateY(-2px);
                        box-shadow: var(--shadow-md);
                    }

                    .followership-card.selected {
                        border-color: var(--accent-500);
                        background: linear-gradient(135deg, var(--accent-500), var(--accent-400));
                        color: white;
                        transform: translateY(-2px);
                        box-shadow: var(--shadow-lg);
                    }

                    .followership-name {
                        font-weight: 600;
                        font-size: var(--font-size-xl);
                        margin-bottom: var(--space-2);
                        color: var(--primary-700);
                    }

                    .followership-desc {
                        font-size: var(--font-size-base);
                        opacity: 0.9;
                        line-height: 1.5;
                        color: var(--primary-600);
                    }

                    .followership-card.selected .followership-name {
                        color: white;
                    }

                    .followership-card.selected .followership-desc {
                        color: rgba(255, 255, 255, 0.95);
                    }

                    .compatibility-results {
                        margin-top: var(--space-12);
                    }

                    .compatibility-item {
                        background: white;
                        border-radius: var(--radius-xl);
                        padding: var(--space-6);
                        margin-bottom: var(--space-4);
                        display: flex;
                        align-items: center;
                        gap: var(--space-6);
                        box-shadow: var(--shadow-md);
                        border: 1px solid var(--primary-100);
                        transition: all var(--transition-base);
                    }

                    .compatibility-item:hover {
                        transform: translateY(-2px);
                        box-shadow: var(--shadow-lg);
                    }

                    .compatibility-score {
                        flex-shrink: 0;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        min-width: 5rem;
                    }

                    .compatibility-info {
                        flex-grow: 1;
                        margin-left: var(--space-4);
                        text-align: left;
                    }

                    .compatibility-info h4 {
                        margin-bottom: var(--space-2);
                        color: var(--primary-900);
                        font-weight: 600;
                        font-size: var(--font-size-xl);
                    }

                    .compatibility-message {
                        color: var(--primary-600);
                        font-size: var(--font-size-base);
                        line-height: 1.6;
                    }

                    .score-circle {
                        width: 4rem;
                        height: 4rem;
                        border-radius: var(--radius-full);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-weight: 700;
                        color: white;
                        margin-bottom: 0;
                        font-size: var(--font-size-lg);
                        box-shadow: var(--shadow-md);
                        border: 3px solid rgba(255, 255, 255, 0.2);
                    }

                    .score-excellent { background: linear-gradient(135deg, var(--success-500), var(--success-400)); }
                    .score-good { background: linear-gradient(135deg, #3b82f6, #60a5fa); }
                    .score-average { background: linear-gradient(135deg, var(--warning-500), var(--warning-400)); color: white; }
                    .score-caution { background: linear-gradient(135deg, #f97316, #fb923c); }
                    .score-poor { background: linear-gradient(135deg, var(--error-500), var(--error-400)); }

                    .score-level {
                        font-size: var(--font-size-xs);
                        font-weight: 600;
                        color: var(--primary-600);
                        text-align: center;
                        margin-top: var(--space-1);
                        white-space: nowrap;
                    }

                    .member-name-input {
                        width: 100%;
                        padding: var(--space-2);
                        border: 1px solid var(--primary-300);
                        border-radius: var(--radius-md);
                        margin-top: var(--space-3);
                        font-size: var(--font-size-sm);
                        background: var(--primary-50);
                        transition: all var(--transition-base);
                    }

                    .member-name-input:focus {
                        outline: none;
                        border-color: var(--accent-500);
                        background: white;
                        box-shadow: 0 0 0 2px rgba(var(--accent-500-rgb), 0.2);
                    }

                    .member-name-input::placeholder {
                        color: var(--primary-400);
                    }

                    .followership-card.selected .member-name-input {
                        background: rgba(255, 255, 255, 0.95);
                        border-color: rgba(255, 255, 255, 0.5);
                        color: var(--primary-900);
                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                        animation: slideDown 0.3s ease;
                    }

                    @keyframes slideDown {
                        from {
                            opacity: 0;
                            transform: translateY(-10px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }

                    .followership-card.selected .member-name-input::placeholder {
                        color: var(--primary-400);
                    }

                    .followership-card.selected .member-name-input:focus {
                        background: white;
                        color: var(--primary-900);
                        border-color: var(--accent-500);
                        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
                    }

                    /* 모바일 반응형 개선 */
                    @media (max-width: 768px) {
                        .followership-grid {
                            grid-template-columns: 1fr;
                            gap: var(--space-2);
                        }

                        .followership-card {
                            padding: var(--space-4) var(--space-6);
                        }

                        .compatibility-item {
                            flex-direction: row;
                            gap: var(--space-4);
                        }

                        .compatibility-score {
                            min-width: 4rem;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                        }

                        .compatibility-info {
                            margin-left: var(--space-2);
                            text-align: left;
                        }

                        .compatibility-info h4 {
                            font-size: var(--font-size-lg);
                            margin-bottom: var(--space-1);
                        }

                        .compatibility-message {
                            font-size: var(--font-size-sm);
                        }

                        .score-circle {
                            width: 3.5rem;
                            height: 3.5rem;
                            font-size: var(--font-size-base);
                        }

                        .followership-card {
                            padding: var(--space-3) var(--space-4);
                        }

                        .followership-name {
                            font-size: var(--font-size-lg);
                        }

                        .followership-desc {
                            font-size: var(--font-size-base);
                        }

                        .member-name-input {
                            font-size: var(--font-size-sm);
                            padding: var(--space-2);
                        }
                    }

                    @media (max-width: 480px) {
                        .compatibility-item {
                            padding: var(--space-4);
                            gap: var(--space-3);
                        }

                        .compatibility-score {
                            min-width: 3.5rem;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                        }

                        .score-circle {
                            width: 3.5rem;
                            height: 3.5rem;
                            font-size: var(--font-size-base);
                        }

                        .compatibility-info {
                            margin-left: var(--space-1);
                            text-align: left;
                        }

                        .compatibility-info h4 {
                            font-size: var(--font-size-lg);
                            line-height: 1.3;
                        }

                        .compatibility-message {
                            font-size: var(--font-size-sm);
                            line-height: 1.5;
                        }

                        .followership-card {
                            padding: var(--space-3);
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            teamCompatibility.getFollowershipTypes().forEach(follower => {
                const card = document.createElement('div');
                card.className = 'followership-card';
                card.onclick = (e) => {
                    // 이름 입력 필드 클릭 시에는 카드 선택 안함
                    if (e.target.tagName !== 'INPUT') {
                        toggleFollowerType(follower.id, card);
                    }
                };
                card.innerHTML = `
                    <div class="followership-name">${follower.name}</div>
                    <div class="followership-desc">${follower.description}</div>
                    <input type="text" class="member-name-input" placeholder="팀원 이름 입력 (선택사항)"
                           style="display: none;"
                           oninput="updateMemberName('${follower.id}', this.value)">
                `;
                container.appendChild(card);
            });
        }

        function toggleFollowerType(followerId, element) {
            const index = selectedFollowerTypes.findIndex(item => item.id === followerId);
            const nameInput = element.querySelector('.member-name-input');

            if (index > -1) {
                selectedFollowerTypes.splice(index, 1);
                element.classList.remove('selected');
                nameInput.style.display = 'none';
                nameInput.value = '';
            } else {
                selectedFollowerTypes.push({
                    id: followerId,
                    name: teamCompatibility.getFollowershipTypes().find(f => f.id === followerId).name,
                    memberName: ''
                });
                element.classList.add('selected');
                nameInput.style.display = 'block';
                setTimeout(() => nameInput.focus(), 100);
            }

            document.getElementById('analyzeBtn').disabled = selectedFollowerTypes.length === 0;
        }

        function updateMemberName(followerId, memberName) {
            const follower = selectedFollowerTypes.find(item => item.id === followerId);
            if (follower) {
                follower.memberName = memberName;
            }
        }

        window.analyzeCompatibility = function() {
            console.log('=== analyzeCompatibility 함수 시작 ===');
            console.log('selectedFollowerTypes:', selectedFollowerTypes);

            try {
                if (selectedFollowerTypes.length === 0) {
                    showErrorMessage('팀원을 선택해주세요.');
                    return;
                }

                const leadershipResult = assessment.determineLeadershipType();
                console.log('leadershipResult:', leadershipResult);

                if (!leadershipResult || !leadershipResult.code) {
                    throw new Error('리더십 진단 결과를 찾을 수 없습니다.');
                }

                const teamReport = teamCompatibility.generateTeamReport(leadershipResult, selectedFollowerTypes);
                console.log('teamReport:', teamReport);

                const resultsContainer = document.getElementById('compatibilityList');
                if (!resultsContainer) {
                    throw new Error('결과 컨테이너를 찾을 수 없습니다.');
                }

                resultsContainer.innerHTML = '';

                teamReport.teamMembers.forEach(member => {
                    console.log('Processing member:', member);

                    // 팔로워 정보가 없으면 스킵
                    if (!member.follower) {
                        console.error('Follower not found for member:', member);
                        return;
                    }

                    const item = document.createElement('div');
                    item.className = 'compatibility-item';

                    const scoreClass = getScoreClass(member.compatibility.score);

                    // 팀원 이름이 있으면 표시, 없으면 팔로워십 유형만 표시
                    const displayName = member.memberName
                        ? `${member.memberName} (${member.follower.name})`
                        : member.follower.name;

                    item.innerHTML = `
                        <div class="compatibility-score">
                            <div class="score-circle ${scoreClass}">${member.compatibility.score}</div>
                            <div class="score-level">${member.compatibility.level}</div>
                        </div>
                        <div class="compatibility-info">
                            <h4>${displayName}</h4>
                            <div class="compatibility-message">${member.compatibility.message}</div>
                        </div>
                    `;
                    resultsContainer.appendChild(item);
                });

                document.getElementById('compatibilityResults').style.display = 'block';
                console.log('=== 궁합 분석 완료 ===');
            } catch (error) {
                console.error('analyzeCompatibility 에러:', error);
                showErrorMessage('팀 궁합 분석 중 오류가 발생했습니다: ' + error.message);
            }
        }

        function getScoreClass(score) {
            if (score >= 90) return 'score-excellent';
            if (score >= 80) return 'score-good';
            if (score >= 70) return 'score-average';
            if (score >= 60) return 'score-caution';
            return 'score-poor';
        }

        function resetAssessment() {
            // 진단 데이터 초기화
            assessment.reset();
            selectedFollowerTypes = [];
            currentQuestion = 0;

            // 모바일 입력 정리
            if (mobileInput) {
                mobileInput.destroy();
                mobileInput = null;
            }

            // 모바일 네비게이션 숨김
            if (mobileNav) {
                mobileNav.hide();
            }

            // 팔로워십 체크박스 초기화
            const checkboxes = document.querySelectorAll('.followership-checkbox input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });

            // 팀원 이름 입력 필드 초기화 및 숨김
            const nameFields = document.querySelectorAll('.member-name-field');
            nameFields.forEach(field => {
                field.value = '';
                field.style.display = 'none';
            });

            // 결과 영역 숨김 (안전하게 처리)
            const compatibilityResults = document.getElementById('compatibilityResults');
            if (compatibilityResults) {
                compatibilityResults.style.display = 'none';
            }

            // 진행률 바 초기화
            const progressBar = document.getElementById('progressBar');
            const questionNumber = document.getElementById('questionNumber');
            if (progressBar) progressBar.style.width = '0%';
            if (questionNumber) questionNumber.textContent = '0 / 23';

            // 팔로워십 옵션 페이지 초기화
            const followershipContainer = document.getElementById('followershipOptionsPage');
            if (followershipContainer) {
                followershipContainer.innerHTML = '';
            }

            // 결과 보기 버튼 비활성화
            const showResultsBtn = document.getElementById('showResultsBtn');
            if (showResultsBtn) {
                showResultsBtn.disabled = true;
            }

            // 웰컴 화면으로 이동
            showSection('welcome');
        }

        // 테스트용 단축키 기능
        document.addEventListener('keydown', function(e) {
            console.log('키 이벤트 감지:', e.key, 'Ctrl:', e.ctrlKey, 'Meta:', e.metaKey);

            // 진단 화면에서만 작동
            const assessmentActive = document.getElementById('assessment').classList.contains('active');
            console.log('진단 화면 활성:', assessmentActive);

            if (assessmentActive) {
                // Ctrl/Cmd + 숫자키로 점수 자동 입력
                if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '6') {
                    e.preventDefault();
                    const value = parseInt(e.key);
                    console.log('점수 입력 시도:', value);

                    if (mobileInput) {
                        console.log('mobileInput 존재, setValue 호출');
                        mobileInput.setValue(value);
                        const question = assessment.getQuestion(currentQuestion);
                        assessment.recordResponse(question.id, value);
                        updateNextButton();
                        console.log('점수 입력 완료:', value);
                    } else {
                        console.log('mobileInput이 없음');
                    }
                }

                // Ctrl/Cmd + Shift + F: 4.5 기준 랜덤 점수로 채우기
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key.toLowerCase() === 'f') {
                    e.preventDefault();
                    console.log('4.5 기준 랜덤 점수 채우기 시작');
                    fillAllQuestionsRandomly();
                }
                // Ctrl/Cmd + F: 모든 질문을 5점으로 빠르게 채우기
                else if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'f') {
                    e.preventDefault();
                    console.log('모든 질문 5점 채우기 시작');
                    fillAllQuestionsWithScore(5);
                }

                // Ctrl/Cmd + H: 모든 질문을 고점수(6점)로 빠르게 채우기
                if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'h') {
                    e.preventDefault();
                    console.log('모든 질문 6점 채우기 시작');
                    fillAllQuestionsWithScore(6);
                }

                // Ctrl/Cmd + L: 모든 질문을 저점수(2점)로 빠르게 채우기
                if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'l') {
                    e.preventDefault();
                    console.log('모든 질문 2점 채우기 시작');
                    fillAllQuestionsWithScore(2);
                }

                // 추가: 단순한 숫자키만으로도 점수 입력 가능 (Ctrl/Cmd 없이)
                if (!e.ctrlKey && !e.metaKey && !e.shiftKey && !e.altKey && e.key >= '1' && e.key <= '6') {
                    const value = parseInt(e.key);
                    console.log('단순 숫자키 입력:', value);

                    if (mobileInput) {
                        mobileInput.setValue(value);
                        const question = assessment.getQuestion(currentQuestion);
                        assessment.recordResponse(question.id, value);
                        updateNextButton();
                        console.log('단순 숫자키로 점수 입력 완료:', value);
                    }
                }
            }
        });

        // 모든 질문을 특정 점수로 채우는 함수
        function fillAllQuestionsWithScore(score) {
            const totalQuestions = assessment.getTotalQuestions();

            // 모든 질문에 점수 기록
            for (let i = 0; i < totalQuestions; i++) {
                const question = assessment.getQuestion(i);
                assessment.recordResponse(question.id, score);
            }

            // 현재 질문의 UI 업데이트
            if (mobileInput) {
                mobileInput.setValue(score);
            }
            updateNextButton();

            // 안내 메시지
            console.log(`모든 질문이 ${score}점으로 설정되었습니다. 이제 '다음' 버튼을 눌러 결과를 확인하거나 다음 질문으로 넘어가세요.`);
        }

        // 모든 질문을 4.5 기준 랜덤 점수로 채우는 함수
        function fillAllQuestionsRandomly() {
            const totalQuestions = assessment.getTotalQuestions();
            const baseScore = 4.5;
            const scores = [];

            // 모든 질문에 랜덤 점수 생성 및 기록
            for (let i = 0; i < totalQuestions; i++) {
                const question = assessment.getQuestion(i);

                // 4.5를 중심으로 ±0.5~1.5 범위의 랜덤 값 생성
                // 결과: 3~6 범위의 점수 (1~6 사이로 제한)
                const randomOffset = (Math.random() * 2 - 1) * 1.5; // -1.5 ~ +1.5
                let randomScore = baseScore + randomOffset;

                // 1~6 범위로 제한하고 반올림
                randomScore = Math.max(1, Math.min(6, Math.round(randomScore)));

                assessment.recordResponse(question.id, randomScore);
                scores.push(randomScore);
            }

            // 현재 질문의 UI 업데이트
            if (mobileInput) {
                const currentScore = scores[currentQuestion];
                mobileInput.setValue(currentScore);
            }
            updateNextButton();

            // 점수 분포 확인
            const avg = (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(2);
            console.log(`모든 질문이 4.5 기준 랜덤 점수로 설정되었습니다.`);
            console.log(`평균: ${avg}점, 범위: ${Math.min(...scores)}~${Math.max(...scores)}점`);
            console.log(`점수 분포:`, scores);
        }

        // 단축키 안내 함수 (콘솔에서 확인 가능)
        window.showTestShortcuts = function() {
            console.log(`
=== 테스트용 단축키 안내 ===
진단 화면에서 사용 가능:

🔢 점수 입력:
• 1~6 숫자키: 현재 질문에 해당 점수 입력 (간단!)
• Ctrl/Cmd + 1~6: 현재 질문에 해당 점수 입력

⚡ 빠른 채우기:
• Ctrl/Cmd + Shift + F: 4.5 기준 랜덤 점수로 채우기 (현실적인 테스트)
• Ctrl/Cmd + F: 모든 질문을 5점으로 채우기
• Ctrl/Cmd + H: 모든 질문을 고점수(6점)로 채우기
• Ctrl/Cmd + L: 모든 질문을 저점수(2점)로 채우기

💡 팁: 숫자키 1~6만 눌러도 점수가 입력됩니다!

콘솔에서 showTestShortcuts() 호출하면 이 안내를 다시 볼 수 있습니다.
========================
            `);
        };

        // 성능 모니터링
        if ('PerformanceObserver' in window) {
            const perfObserver = new PerformanceObserver((entryList) => {
                for (const entry of entryList.getEntries()) {
                    if (entry.entryType === 'navigation') {
                        console.log('페이지 로드 시간:', entry.loadEventEnd - entry.fetchStart, 'ms');
                    }
                    if (entry.entryType === 'paint') {
                        console.log(entry.name + ':', entry.startTime, 'ms');
                    }
                }
            });

            try {
                perfObserver.observe({ entryTypes: ['navigation', 'paint'] });
            } catch (e) {
                // Safari may not support all entry types
                console.log('성능 모니터링 일부 미지원');
            }
        }

        // 모바일 네비게이션 초기화 함수
        function initMobileNav() {
            if (window.innerWidth <= 768) {
                if (!mobileNav) {
                    mobileNav = new MobileNavigationManager();
                }
                // 진단 페이지가 아니면 숨김
                const isAssessmentPage = document.getElementById('assessment').classList.contains('active');
                if (!isAssessmentPage) {
                    mobileNav.hide();
                }
            } else {
                // 데스크톱 화면에서는 모바일 네비게이션 숨김
                if (mobileNav) {
                    mobileNav.hide();
                }
            }
        }

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initMobileNav();

            // 개발 모드일 때 단축키 안내 표시
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                console.log('🚀 개발 모드: 테스트용 단축키가 활성화되었습니다. showTestShortcuts()를 입력하여 단축키를 확인하세요.');
            }

        });

        // 화면 크기 변경 시 모바일 네비게이션 재초기화
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                initMobileNav();
            }, 100);
        });
    </script>
</body>
</html>